
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. Métodos Robustos para Datos Temporales &#8212; Bike Sharing Regression</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex": {"tags": "ams", "useLabelIds": true}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/5_metodos_robustos';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Validación y Selección del Modelo" href="6_validacion_modelo.html" />
    <link rel="prev" title="4. Implementación Matricial de MCO y diagnosticos de supuestos" href="4_mco_matricial.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="0_prefacio.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/bike.png" class="logo__image only-light" alt="Bike Sharing Regression - Home"/>
    <script>document.write(`<img src="../_static/bike.png" class="logo__image only-dark" alt="Bike Sharing Regression - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0_prefacio.html">
                    Presentación
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Prefacio</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="0_guia_reproduccion.html">0.1 Guía de reproducción</a></li>
<li class="toctree-l1"><a class="reference internal" href="0_demostraciones.html">0.2 Demostraciones solicitadas</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contenido</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_intro_contexto.html">1. Introducción y contexto de movilidad urbana</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_ingenieria_temporal.html">2. Ingenieria de Variables y Procesamiento Temporal</a></li>

<li class="toctree-l1"><a class="reference internal" href="3_exploratorio_temporal.html">3. Análisis exploratorio de series temporales</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_mco_matricial.html">4. Matricial de MCO y diagnostico de supuestos</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">5. Métodos robustos para datos temporales</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_validacion_modelo.html">6. Validación y selección del modelo</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_monte_carlo.html">7. Simulación Monte Carlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_interpretacion_operativa.html">8. Interpretación operativa y recomendaciones</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_conclusiones_extensiones.html">9. Conclusiones y extensiones futuras</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_referencias.html">10. Referencias</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/5_metodos_robustos.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>5. Métodos Robustos para Datos Temporales</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importacion-de-librerias">5.1. Importacion de librerias</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lectura-de-datos">5.2. Lectura de datos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#split-data-set-training-and-test">5.3 Split data set (Training and test)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#errores-estandar-hac-neweywest">5.4 Errores estándar HAC (Newey–West).</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-hac-neweywest">Método HAC (Newey–West)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-ols">Modelo OLS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estimador-hac">Estimador HAC</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Estimador HAC</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parametros">Parámetros</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretacion">Interpretación</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimadores-m-robust-huber-y-tukey">5.5 Estimadores M Robust (Huber y Tukey)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aplicacion-sobre-un-modelo-ols">Aplicación sobre un modelo OLS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimador-m-general">Estimador M general</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimador-de-huber">Estimador de Huber</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimador-tukey-bisquare-biweight">Estimador Tukey Bisquare (Biweight)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-huber-y-tukey">5.5.1 Metodo Huber y Tukey</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-temporal-moving-block-bootstrap-2000-replicas">5.5.2. Bootstrap temporal (Moving Block Bootstrap) — 2000 réplicas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eleccion-de-la-longitud-de-bloque-ell">Elección de la longitud de bloque  <span class="math notranslate nohighlight">\(\ell\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tabla-comparativa-robustez-de-los-coeficientes-por-metodo">5.6 Tabla comparativa, robustez de los coeficientes por metodo</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#que-significa-que-un-coeficiente-es-robusto">5.6.1 ¿Qué significa que un coeficiente es “robusto”?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#criterios-de-robustez-utilizados">5.6.2 ¿Criterios de Robustez utilizados?</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="metodos-robustos-para-datos-temporales">
<h1>5. Métodos Robustos para Datos Temporales<a class="headerlink" href="#metodos-robustos-para-datos-temporales" title="Link to this heading">#</a></h1>
<p>Dado los desarrollos anteriores, se obtuvo que en el modelo de ajuste lineal los errores no satisfacen los supuestos de normalidad y homocedasticidad (varianza costante)<br />
Para lo anterior, en esta seccion estaremos explorando el uso de tecnicas como:</p>
<ol class="arabic simple">
<li><p>Errores estandar HAC (Newey West)</p></li>
<li><p>Estimadores robustos M (Huber, Tukey)</p></li>
<li><p>Boostrap temporal (Block boostrap)</p></li>
</ol>
<section id="importacion-de-librerias">
<h2>5.1. Importacion de librerias<a class="headerlink" href="#importacion-de-librerias" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Librerías científicas básicas</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>

<span class="c1"># Visualización</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>

<span class="c1"># Modelos estadísticos</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.outliers_influence</span><span class="w"> </span><span class="kn">import</span> <span class="n">variance_inflation_factor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">OLS</span><span class="p">,</span> <span class="n">add_constant</span>
 
<span class="c1"># Machine Learning</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.feature_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">RFE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="lectura-de-datos">
<h2>5.2. Lectura de datos<a class="headerlink" href="#lectura-de-datos" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/day_clean.csv&quot;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="split-data-set-training-and-test">
<h2>5.3 Split data set (Training and test)<a class="headerlink" href="#split-data-set-training-and-test" title="Link to this heading">#</a></h2>
<p>En este apartado separaremos los datos en un 70% para entremaniento de los modelos y un 30% para testing de los mismos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># df ordenado</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">cut</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">)</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">test</span>  <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">cut</span><span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tamaño set de entrenamiento:&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tamaño set de prueba:&quot;</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tamaño set de entrenamiento: (511, 17)
tamaño set de prueba: (220, 17)
</pre></div>
</div>
</div>
</div>
</section>
<section id="errores-estandar-hac-neweywest">
<h2>5.4 Errores estándar HAC (Newey–West).<a class="headerlink" href="#errores-estandar-hac-neweywest" title="Link to this heading">#</a></h2>
<section id="metodo-hac-neweywest">
<h3>Método HAC (Newey–West)<a class="headerlink" href="#metodo-hac-neweywest" title="Link to this heading">#</a></h3>
<p>El estimador de <strong>Errores estándar HAC (Heteroskedasticity and Autocorrelation Consistent)</strong> ajusta la matriz de varianzas y covarianzas de los coeficientes OLS para ser robusta frente a heterocedasticidad y autocorrelación.</p>
<section id="modelo-ols">
<h4>Modelo OLS<a class="headerlink" href="#modelo-ols" title="Link to this heading">#</a></h4>
<div class="math notranslate nohighlight">
\[
y_t = X_t \beta + u_t
\]</div>
</section>
<section id="estimador-hac">
<h4>Estimador HAC<a class="headerlink" href="#estimador-hac" title="Link to this heading">#</a></h4>
</section>
<section id="id1">
<h4>Estimador HAC<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<div class="math notranslate nohighlight">
\[
\widehat{V}_{HAC} = (X'X)^{-1} \, \widehat{S} \, (X'X)^{-1}
\]</div>
<p>donde:
$$
\widehat{S} = \sum_{t=1}^{T} \hat{u}_t^2 X_t X_t’</p>
<ul class="simple">
<li><p>\sum_{l=1}^{q} w_l \sum_{t=l+1}^{T} \hat{u}t \hat{u}{t-l}
\big( X_t X_{t-l}’ + X_{t-l} X_t’ \big)
$$</p></li>
</ul>
</section>
<section id="parametros">
<h4>Parámetros<a class="headerlink" href="#parametros" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\hat{u}_t\)</span>: residuos estimados del modelo OLS</p></li>
<li><p><span class="math notranslate nohighlight">\(X_t\)</span>: vector de regresores en el tiempo <span class="math notranslate nohighlight">\(t\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(q\)</span>: número de rezagos (<code class="docutils literal notranslate"><span class="pre">maxlags</span></code>) especificado</p></li>
<li><p><span class="math notranslate nohighlight">\(w_l = 1 - \frac{l}{q+1}\)</span>: pesos de Bartlett que decrecen linealmente con el rezago</p></li>
</ul>
</section>
<section id="interpretacion">
<h4>Interpretación<a class="headerlink" href="#interpretacion" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>El primer término corrige la <strong>heterocedasticidad</strong>.</p></li>
<li><p>El segundo término corrige la <strong>autocorrelación</strong> hasta el rezago <span class="math notranslate nohighlight">\(q\)</span>.</p></li>
<li><p>Los coeficientes <span class="math notranslate nohighlight">\(\beta\)</span> no cambian, pero los errores estándar y las pruebas de significancia se ajustan.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.diagnostic</span><span class="w"> </span><span class="kn">import</span> <span class="n">acorr_ljungbox</span>

<span class="c1"># 1) Cargar el modelo OLS guardado</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../models/ols_model.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">ols_model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># 2) Heurística de maxlags según tamaño de muestra (Newey–West)</span>
<span class="n">resid</span> <span class="o">=</span> <span class="n">ols_model</span><span class="o">.</span><span class="n">resid</span>
<span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>
<span class="n">heuristic_maxlags</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="mf">9.0</span><span class="p">)))</span>
<span class="n">heuristic_maxlags</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">heuristic_maxlags</span><span class="p">)</span>

<span class="c1"># 3) Opcional: ajustar por frecuencia (ejemplo: mensual, cap en 12)</span>
<span class="c1"># freq_cap = 12</span>
<span class="c1"># maxlags = min(heuristic_maxlags, freq_cap)</span>

<span class="n">maxlags</span> <span class="o">=</span> <span class="n">heuristic_maxlags</span>

<span class="c1"># 4) Diagnóstico rápido con Ljung–Box en el lag elegido</span>
<span class="n">lb</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">resid</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="n">maxlags</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ljung–Box p-value at lag=</span><span class="si">{</span><span class="n">maxlags</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">lb</span><span class="p">[</span><span class="s1">&#39;lb_pvalue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 5) Aplicar HAC (Newey–West)</span>
<span class="n">modelo_hac</span> <span class="o">=</span> <span class="n">ols_model</span><span class="o">.</span><span class="n">get_robustcov_results</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s2">&quot;HAC&quot;</span><span class="p">,</span> <span class="n">maxlags</span><span class="o">=</span><span class="n">maxlags</span><span class="p">)</span>

<span class="c1"># 6) Resumen con errores estándar corregidos</span>
<span class="nb">print</span><span class="p">(</span><span class="n">modelo_hac</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ljung–Box p-value at lag=5: 0.0000
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                    cnt   R-squared:                       0.818
Model:                            OLS   Adj. R-squared:                  0.814
Method:                 Least Squares   F-statistic:                     207.0
Date:                Sat, 29 Nov 2025   Prob (F-statistic):          1.25e-170
Time:                        05:18:28   Log-Likelihood:                -4055.4
No. Observations:                 511   AIC:                             8133.
Df Residuals:                     500   BIC:                             8179.
Df Model:                          10                                         
Covariance Type:                  HAC                                         
================================================================================
                   coef    std err          t      P&gt;|t|      [0.025      0.975]
--------------------------------------------------------------------------------
const         1675.7821    241.445      6.941      0.000    1201.409    2150.155
yr            1971.3348    108.192     18.221      0.000    1758.768    2183.901
temp          5113.4516    542.694      9.422      0.000    4047.210    6179.693
hum          -1240.4722    321.693     -3.856      0.000   -1872.509    -608.435
windspeed    -2770.3893    509.812     -5.434      0.000   -3772.028   -1768.751
season_2      1045.7043    173.750      6.018      0.000     704.334    1387.075
season_3       658.2456    264.977      2.484      0.013     137.640    1178.851
season_4      1424.8186    131.343     10.848      0.000    1166.767    1682.870
weathersit_2  -374.8274     81.030     -4.626      0.000    -534.028    -215.627
weathersit_3 -1668.3896    211.689     -7.881      0.000   -2084.299   -1252.480
holiday_1     -527.9564    226.356     -2.332      0.020    -972.682     -83.230
==============================================================================
Omnibus:                       35.872   Durbin-Watson:                   1.253
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               91.666
Skew:                          -0.334   Prob(JB):                     1.24e-20
Kurtosis:                       4.965   Cond. No.                         22.4
==============================================================================

Notes:
[1] Standard Errors are heteroscedasticity and autocorrelation robust (HAC) using 5 lags and without small sample correction
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="estimadores-m-robust-huber-y-tukey">
<h2>5.5 Estimadores M Robust (Huber y Tukey)<a class="headerlink" href="#estimadores-m-robust-huber-y-tukey" title="Link to this heading">#</a></h2>
<section id="aplicacion-sobre-un-modelo-ols">
<h3>Aplicación sobre un modelo OLS<a class="headerlink" href="#aplicacion-sobre-un-modelo-ols" title="Link to this heading">#</a></h3>
<p>Cuando hacemos regresión OLS, los coeficientes se estiman minimizando:</p>
<div class="math notranslate nohighlight">
\[
\min_\beta \sum_{i=1}^n (y_i - x_i^\top \beta)^2
\]</div>
<p>Esto hace que OLS sea <strong>muy sensible a valores atípicos</strong>, porque los residuos grandes se elevan al cuadrado.</p>
<p>Los <strong>estimadores M</strong> reducen la influencia de estos valores usando una función de pérdida <span class="math notranslate nohighlight">\( \rho(\cdot) \)</span> que penaliza menos a los outliers.</p>
</section>
<section id="estimador-m-general">
<h3>Estimador M general<a class="headerlink" href="#estimador-m-general" title="Link to this heading">#</a></h3>
<p>Los estimadores M encuentran los coeficientes resolviendo:</p>
<div class="math notranslate nohighlight">
\[
\hat{\beta} = \arg\min_\beta \sum_{i=1}^n \rho(r_i)
\]</div>
<p>donde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( r_i = \frac{y_i - x_i^\top\beta}{\hat{\sigma}}\)</span> es el residuo estandarizado</p></li>
<li><p><span class="math notranslate nohighlight">\( \rho(\cdot)\)</span> es una función de pérdida robusta</p></li>
</ul>
<p>La ecuación de primer orden usa la función <span class="math notranslate nohighlight">\(\psi(r) = \rho'(r)\)</span>, y se resuelve:</p>
<div class="math notranslate nohighlight">
\[
\sum_{i=1}^n \psi(r_i)x_i = 0
\]</div>
</section>
<section id="estimador-de-huber">
<h3>Estimador de Huber<a class="headerlink" href="#estimador-de-huber" title="Link to this heading">#</a></h3>
<p>La función de pérdida es:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\rho(r)=
\begin{cases}
\frac{1}{2}r^2 &amp; |r| \le c \\
c|r| - \frac{1}{2}c^2 &amp; |r| &gt; c
\end{cases}
\end{split}\]</div>
<p>La función derivada <span class="math notranslate nohighlight">\(\psi(r)\)</span> es:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\psi(r)=
\begin{cases}
r &amp; |r|\le c \\
c \,\text{sign}(r) &amp; |r| &gt; c
\end{cases}
\end{split}\]</div>
<p>Reduce la influencia de outliers moderados sin descartarlos.</p>
</section>
<section id="estimador-tukey-bisquare-biweight">
<h3>Estimador Tukey Bisquare (Biweight)<a class="headerlink" href="#estimador-tukey-bisquare-biweight" title="Link to this heading">#</a></h3>
<p>Función de pérdida:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\rho(r) =
\begin{cases}
\frac{c^2}{6}\left[1 - \left(1 - \left(\frac{r}{c}\right)^2\right)^3\right] &amp; |r| \le c \\
\frac{c^2}{6} &amp; |r| &gt; c
\end{cases}
\end{split}\]</div>
<p>Derivada <span class="math notranslate nohighlight">\(\psi(r)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\psi(r)=
\begin{cases}
r \left(1 - \left(\frac{r}{c}\right)^2\right)^2 &amp; |r| \le c \\
0 &amp; |r| &gt; c
\end{cases}
\end{split}\]</div>
<p>Los outliers muy extremos reciben peso <span class="math notranslate nohighlight">\(0\)</span> (se excluyen del ajuste).</p>
</section>
<section id="metodo-huber-y-tukey">
<h3>5.5.1 Metodo Huber y Tukey<a class="headerlink" href="#metodo-huber-y-tukey" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recuperar X y y con nombres reales desde el modelo</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">ols_model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ols_model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">ols_model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog_names</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">ols_model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Huber</span>
<span class="n">huber_model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">RLM</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">robust</span><span class="o">.</span><span class="n">norms</span><span class="o">.</span><span class="n">HuberT</span><span class="p">())</span>
<span class="n">huber_results</span> <span class="o">=</span> <span class="n">huber_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Tukey</span>
<span class="n">tukey_model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">RLM</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">robust</span><span class="o">.</span><span class="n">norms</span><span class="o">.</span><span class="n">TukeyBiweight</span><span class="p">())</span>
<span class="n">tukey_results</span> <span class="o">=</span> <span class="n">tukey_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Huber ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">huber_results</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Tukey ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tukey_results</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Huber ===
                    Robust linear Model Regression Results                    
==============================================================================
Dep. Variable:                    cnt   No. Observations:                  511
Model:                            RLM   Df Residuals:                      500
Method:                          IRLS   Df Model:                           10
Norm:                          HuberT                                         
Scale Est.:                       mad                                         
Cov Type:                          H1                                         
Date:                Sat, 29 Nov 2025                                         
Time:                        05:18:28                                         
No. Iterations:                     9                                         
================================================================================
                   coef    std err          z      P&gt;|z|      [0.025      0.975]
--------------------------------------------------------------------------------
const         1498.4148    194.846      7.690      0.000    1116.524    1880.306
yr            1980.6849     71.025     27.887      0.000    1841.478    2119.891
temp          5292.3244    274.823     19.257      0.000    4753.682    5830.967
hum          -1112.7283    258.358     -4.307      0.000   -1619.100    -606.357
windspeed    -2505.2158    391.098     -6.406      0.000   -3271.755   -1738.677
season_2      1031.7553     92.981     11.096      0.000     849.516    1213.995
season_3       620.5304    141.394      4.389      0.000     343.404     897.657
season_4      1450.6798     98.907     14.667      0.000    1256.826    1644.534
weathersit_2  -393.0356     74.344     -5.287      0.000    -538.747    -247.324
weathersit_3 -1735.9361    179.112     -9.692      0.000   -2086.989   -1384.883
holiday_1     -527.2939    172.025     -3.065      0.002    -864.456    -190.132
================================================================================

If the model instance has been used for another fit with different fit parameters, then the fit options might not be the correct ones anymore .
=== Tukey ===
                    Robust linear Model Regression Results                    
==============================================================================
Dep. Variable:                    cnt   No. Observations:                  511
Model:                            RLM   Df Residuals:                      500
Method:                          IRLS   Df Model:                           10
Norm:                   TukeyBiweight                                         
Scale Est.:                       mad                                         
Cov Type:                          H1                                         
Date:                Sat, 29 Nov 2025                                         
Time:                        05:18:28                                         
No. Iterations:                    12                                         
================================================================================
                   coef    std err          z      P&gt;|z|      [0.025      0.975]
--------------------------------------------------------------------------------
const         1447.5814    194.554      7.441      0.000    1066.263    1828.899
yr            1983.6007     70.918     27.970      0.000    1844.603    2122.598
temp          5267.8493    274.410     19.197      0.000    4730.015    5805.683
hum          -1059.2617    257.970     -4.106      0.000   -1564.874    -553.650
windspeed    -2383.1708    390.512     -6.103      0.000   -3148.560   -1617.782
season_2      1047.3717     92.842     11.281      0.000     865.405    1229.338
season_3       667.2487    141.181      4.726      0.000     390.538     943.959
season_4      1466.6286     98.758     14.851      0.000    1273.066    1660.191
weathersit_2  -407.0903     74.233     -5.484      0.000    -552.583    -261.597
weathersit_3 -1730.5007    178.843     -9.676      0.000   -2081.027   -1379.974
holiday_1     -540.9973    171.767     -3.150      0.002    -877.654    -204.341
================================================================================

If the model instance has been used for another fit with different fit parameters, then the fit options might not be the correct ones anymore .
</pre></div>
</div>
</div>
</div>
</section>
<section id="bootstrap-temporal-moving-block-bootstrap-2000-replicas">
<h3>5.5.2. Bootstrap temporal (Moving Block Bootstrap) — 2000 réplicas<a class="headerlink" href="#bootstrap-temporal-moving-block-bootstrap-2000-replicas" title="Link to this heading">#</a></h3>
<p>Cuando los datos son temporales (autocorrelación, dependencias en el tiempo) no se puede re-muestrear observaciones individuales de forma independiente sin romper la estructura temporal. El <strong>block bootstrap</strong> re-muestrea <strong>bloques contiguos</strong> de observaciones para preservar la dependencia local.</p>
<p>En el <strong>Moving Block Bootstrap (MBB)</strong>:</p>
<ul class="simple">
<li><p>Elegimos una longitud de bloque <span class="math notranslate nohighlight">\( \ell \)</span>.</p></li>
<li><p>Construimos bloques superpuestos de longitud <span class="math notranslate nohighlight">\( \ell\)</span>: bloque 0 = observaciones [0:<span class="math notranslate nohighlight">\(\ell\)</span>-1], bloque 1 = [1:<span class="math notranslate nohighlight">\(\ell\)</span>], …, hasta el final.</p></li>
<li><p>Para generar una muestra bootstrap de tamaño <span class="math notranslate nohighlight">\(T\)</span>, extraemos <span class="math notranslate nohighlight">\(k = \lceil T / \ell \rceil\)</span> bloques <em>con reemplazo</em> de la lista de bloques y los concatenamos; finalmente recortamos a longitud <span class="math notranslate nohighlight">\(T\)</span>.</p></li>
<li><p>Repetimos esto <span class="math notranslate nohighlight">\(B\)</span> veces (para el ejercicio <span class="math notranslate nohighlight">\(B=2000\)</span>), y para cada muestra bootstrap re-estimamos el modelo OLS y guardamos los coeficientes.</p></li>
<li><p>Las inferencias se hacen sobre la distribución empírica de los coeficientes media, desviación estándar, intervalos percentiles, y demas.</p></li>
</ul>
</section>
<section id="eleccion-de-la-longitud-de-bloque-ell">
<h3>Elección de la longitud de bloque  <span class="math notranslate nohighlight">\(\ell\)</span><a class="headerlink" href="#eleccion-de-la-longitud-de-bloque-ell" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Regla de pulgar común: <span class="math notranslate nohighlight">\(\ell \approx T^{1/3}\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parametros para el bootstrap</span>
<span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tamaño de la muestra T = </span><span class="si">{</span><span class="n">T</span><span class="si">}</span><span class="s2">, variables = </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">B</span> <span class="o">=</span> <span class="mi">2000</span>  <span class="c1"># número de replicas</span>

<span class="c1"># regla de pulgar para longitud de bloque: l = int(T**(1/3))</span>
<span class="n">l</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">T</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Block length l = </span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2"> (regla ~ T^(1/3))&quot;</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="n">l</span><span class="p">))</span>  <span class="c1"># número de bloques a concatenar por réplica</span>

<span class="c1"># listado de indice de bloques</span>
<span class="c1"># cada bloque comienza en i y cubre [i, i+l-1]</span>
<span class="n">block_starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span> <span class="o">-</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">block_starts</span><span class="p">]</span>
<span class="n">n_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Número de bloques = </span><span class="si">{</span><span class="n">n_blocks</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># funcion para el muestreo</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_mbb_indices</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">n_blocks</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Genera un vector de indices de longitud T usando Moving Block Bootstrap (MBB)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="n">l</span><span class="p">))</span>
    
    <span class="c1"># elegir k bloques con reemplazo</span>
    <span class="n">chosen_block_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_blocks</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    
    <span class="n">chosen_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">chosen_block_idxs</span><span class="p">])</span>
    
    <span class="c1"># recortar a longitud T</span>
    <span class="n">chosen_indices</span> <span class="o">=</span> <span class="n">chosen_indices</span><span class="p">[:</span><span class="n">T</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">chosen_indices</span>


<span class="c1"># Ejecutar bootstrap y estimar modelo OLS en cada replica</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">B</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># guardar coeficientes por réplica</span>

<span class="c1"># Para reproducibilidad, puedes fijar semilla:</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">generate_mbb_indices</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">n_blocks</span><span class="p">)</span>

    <span class="n">Xb</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">yb</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">model_b</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">yb</span><span class="p">,</span> <span class="n">Xb</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">coefs</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">model_b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># En caso de error numérico, asignar Nan</span>
        <span class="n">coefs</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Replica </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> falló: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># quitar replicas malas</span>
<span class="n">valid</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">n_valid</span> <span class="o">=</span> <span class="n">valid</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Réplicas válidas: </span><span class="si">{</span><span class="n">n_valid</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">B</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">coefs_valid</span> <span class="o">=</span> <span class="n">coefs</span><span class="p">[</span><span class="n">valid</span><span class="p">,</span> <span class="p">:]</span>

<span class="c1"># metricas para el bootstrap </span>
<span class="n">coef_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">coefs_valid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">coef_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">coefs_valid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ci_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">coefs_valid</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ci_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">coefs_valid</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;coef_mean&quot;</span><span class="p">:</span> <span class="n">coef_mean</span><span class="p">,</span>
    <span class="s2">&quot;coef_std&quot;</span><span class="p">:</span> <span class="n">coef_std</span><span class="p">,</span>
    <span class="s2">&quot;ci_2.5%&quot;</span><span class="p">:</span> <span class="n">ci_lower</span><span class="p">,</span>
    <span class="s2">&quot;ci_97.5%&quot;</span><span class="p">:</span> <span class="n">ci_upper</span>
<span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Resultados bootstrap (MBB, 2000 réplicas):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tamaño de la muestra T = 511, variables = 11
Block length l = 8 (regla ~ T^(1/3))
Número de bloques = 504
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Réplicas válidas: 2000 / 2000

Resultados bootstrap (MBB, 2000 réplicas):
                coef_mean    coef_std      ci_2.5%     ci_97.5%
const         1686.790722  260.499415  1208.094624  2206.435730
yr            1959.505841  121.527986  1733.346816  2207.858443
temp          5160.362327  625.717444  3904.343665  6345.264957
hum          -1267.997593  331.968533 -1944.698048  -650.534727
windspeed    -2780.143244  533.714690 -3844.196096 -1741.039439
season_2      1033.823322  199.180709   677.460154  1464.468929
season_3       633.049696  305.871040    11.669624  1211.773529
season_4      1410.154462  142.060865  1124.520611  1689.108598
weathersit_2  -362.170456   81.434013  -520.814298  -206.134011
weathersit_3 -1657.331872  230.917395 -2102.328290 -1189.897487
holiday_1     -531.687974  235.608843 -1010.262558   -87.796621
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="tabla-comparativa-robustez-de-los-coeficientes-por-metodo">
<h2>5.6 Tabla comparativa, robustez de los coeficientes por metodo<a class="headerlink" href="#tabla-comparativa-robustez-de-los-coeficientes-por-metodo" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extraccion de coeficientes</span>
<span class="n">ols_coef</span> <span class="o">=</span> <span class="n">ols_model</span><span class="o">.</span><span class="n">params</span>
<span class="n">hac_coef</span> <span class="o">=</span> <span class="n">modelo_hac</span><span class="o">.</span><span class="n">params</span>
<span class="n">huber_coef</span> <span class="o">=</span> <span class="n">huber_results</span><span class="o">.</span><span class="n">params</span>
<span class="n">tukey_coef</span> <span class="o">=</span> <span class="n">tukey_results</span><span class="o">.</span><span class="n">params</span>

<span class="c1"># 2) Bootstrap: ya tienes results_df con:</span>
<span class="c1"># coef_mean, coef_std, ci_2.5%, ci_97.5%</span>
<span class="n">boot_mean</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="s2">&quot;coef_mean&quot;</span><span class="p">]</span>

<span class="c1"># 3) Combinar todo en una sola tabla</span>

<span class="n">comparativa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;OLS&quot;</span><span class="p">:</span> <span class="n">ols_coef</span><span class="p">,</span>
    <span class="s2">&quot;HAC (Newey-West)&quot;</span><span class="p">:</span> <span class="n">hac_coef</span><span class="p">,</span>
    <span class="s2">&quot;Huber&quot;</span><span class="p">:</span> <span class="n">huber_coef</span><span class="p">,</span>
    <span class="s2">&quot;Tukey&quot;</span><span class="p">:</span> <span class="n">tukey_coef</span><span class="p">,</span>
    <span class="s2">&quot;Bootstrap Mean&quot;</span><span class="p">:</span> <span class="n">boot_mean</span><span class="p">,</span>
    <span class="s2">&quot;Bootstrap Std&quot;</span><span class="p">:</span> <span class="n">results_df</span><span class="p">[</span><span class="s2">&quot;coef_std&quot;</span><span class="p">],</span>
    <span class="s2">&quot;Boot CI 2.5%&quot;</span><span class="p">:</span> <span class="n">results_df</span><span class="p">[</span><span class="s2">&quot;ci_2.5%&quot;</span><span class="p">],</span>
    <span class="s2">&quot;Boot CI 97.5%&quot;</span><span class="p">:</span> <span class="n">results_df</span><span class="p">[</span><span class="s2">&quot;ci_97.5%&quot;</span><span class="p">]</span>
<span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tabla comparativa de robustez de coeficientes:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">comparativa</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tabla comparativa de robustez de coeficientes:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OLS</th>
      <th>HAC (Newey-West)</th>
      <th>Huber</th>
      <th>Tukey</th>
      <th>Bootstrap Mean</th>
      <th>Bootstrap Std</th>
      <th>Boot CI 2.5%</th>
      <th>Boot CI 97.5%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>const</th>
      <td>1675.782068</td>
      <td>1675.782068</td>
      <td>1498.414789</td>
      <td>1447.581352</td>
      <td>1686.790722</td>
      <td>260.499415</td>
      <td>1208.094624</td>
      <td>2206.435730</td>
    </tr>
    <tr>
      <th>yr</th>
      <td>1971.334810</td>
      <td>1971.334810</td>
      <td>1980.684888</td>
      <td>1983.600678</td>
      <td>1959.505841</td>
      <td>121.527986</td>
      <td>1733.346816</td>
      <td>2207.858443</td>
    </tr>
    <tr>
      <th>temp</th>
      <td>5113.451580</td>
      <td>5113.451580</td>
      <td>5292.324408</td>
      <td>5267.849285</td>
      <td>5160.362327</td>
      <td>625.717444</td>
      <td>3904.343665</td>
      <td>6345.264957</td>
    </tr>
    <tr>
      <th>hum</th>
      <td>-1240.472156</td>
      <td>-1240.472156</td>
      <td>-1112.728298</td>
      <td>-1059.261669</td>
      <td>-1267.997593</td>
      <td>331.968533</td>
      <td>-1944.698048</td>
      <td>-650.534727</td>
    </tr>
    <tr>
      <th>windspeed</th>
      <td>-2770.389319</td>
      <td>-2770.389319</td>
      <td>-2505.215754</td>
      <td>-2383.170836</td>
      <td>-2780.143244</td>
      <td>533.714690</td>
      <td>-3844.196096</td>
      <td>-1741.039439</td>
    </tr>
    <tr>
      <th>season_2</th>
      <td>1045.704252</td>
      <td>1045.704252</td>
      <td>1031.755316</td>
      <td>1047.371689</td>
      <td>1033.823322</td>
      <td>199.180709</td>
      <td>677.460154</td>
      <td>1464.468929</td>
    </tr>
    <tr>
      <th>season_3</th>
      <td>658.245635</td>
      <td>658.245635</td>
      <td>620.530400</td>
      <td>667.248724</td>
      <td>633.049696</td>
      <td>305.871040</td>
      <td>11.669624</td>
      <td>1211.773529</td>
    </tr>
    <tr>
      <th>season_4</th>
      <td>1424.818629</td>
      <td>1424.818629</td>
      <td>1450.679846</td>
      <td>1466.628557</td>
      <td>1410.154462</td>
      <td>142.060865</td>
      <td>1124.520611</td>
      <td>1689.108598</td>
    </tr>
    <tr>
      <th>weathersit_2</th>
      <td>-374.827386</td>
      <td>-374.827386</td>
      <td>-393.035603</td>
      <td>-407.090262</td>
      <td>-362.170456</td>
      <td>81.434013</td>
      <td>-520.814298</td>
      <td>-206.134011</td>
    </tr>
    <tr>
      <th>weathersit_3</th>
      <td>-1668.389609</td>
      <td>-1668.389609</td>
      <td>-1735.936058</td>
      <td>-1730.500657</td>
      <td>-1657.331872</td>
      <td>230.917395</td>
      <td>-2102.328290</td>
      <td>-1189.897487</td>
    </tr>
    <tr>
      <th>holiday_1</th>
      <td>-527.956358</td>
      <td>-527.956358</td>
      <td>-527.293924</td>
      <td>-540.997266</td>
      <td>-531.687974</td>
      <td>235.608843</td>
      <td>-1010.262558</td>
      <td>-87.796621</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="que-significa-que-un-coeficiente-es-robusto">
<h3>5.6.1 ¿Qué significa que un coeficiente es “robusto”?<a class="headerlink" href="#que-significa-que-un-coeficiente-es-robusto" title="Link to this heading">#</a></h3>
<p>Un estimador de un coeficiente es robusto cuando al violar alguno de los supuestos del modelo lineal <strong>NO  cambian mucho</strong> su valor ni su significancia, es decir, se mantiene estable.</p>
<p>Los supuestos típicos que se violan en datos reales son:</p>
<ul class="simple">
<li><p>heteroscedasticidad</p></li>
<li><p>autocorrelación</p></li>
<li><p>colas pesadas / outliers</p></li>
<li><p>dependencia temporal</p></li>
<li><p>no normalidad de residuos</p></li>
</ul>
<p>Es por ello que al revisar los diferentes metodos, estos abordan cada uno un aspecto distinto:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Metodo</p></th>
<th class="head"><p>Corrige o soluciona</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>HAC (Newey-West)</strong></p></td>
<td><p>Autocorrelacion + heteroscedasticidad</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Huber (M-estimation)</strong></p></td>
<td><p>Outliers moderados</p></td>
</tr>
<tr class="row-even"><td><p><strong>Tukey biweight</strong></p></td>
<td><p>Outliers severos</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Bootstrap (block bootstrap)</strong></p></td>
<td><p>Distribucion no normal, dependencia temporal</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="criterios-de-robustez-utilizados">
<h3>5.6.2 ¿Criterios de Robustez utilizados?<a class="headerlink" href="#criterios-de-robustez-utilizados" title="Link to this heading">#</a></h3>
<p>En la evaluacion de robustez, se aplica entonces validaciones entre coeficientes de los diferentes metodos para evaluar:</p>
<ol class="arabic simple">
<li><p><strong>Estabilidad del coeficiente entre metodos:</strong><br />
La magbitud del coeficiente debe ser “parecida” (toleremos una variacion del 20%, tomando por base OLS), por lo que si el valor cambia mucho, entonces el efecto no es tan fiable.</p></li>
<li><p><strong>Estabilidad del signo:</strong><br />
El signo del coeficiente debe ser el mismo en todas los metodos. Si se mueve entre positivo y negativo, la relación no es robusta, ya que la relacion no puede indicar “a veces aumenta, aveces disminuye”.</p></li>
<li><p><strong>Estabilidad de la significancia estadística:</strong><br />
Si en para OLS, HACy Huber/Tukey para el coeficiente su <span class="math notranslate nohighlight">\(p-value &lt; 0.05\)</span>, y el intervalo de bootstrap no contiene al 0, el coeficnicoeficiente es <strong>robusto</strong>.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_rob</span> <span class="o">=</span> <span class="n">comparativa</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Criterios de robustez</span>

<span class="c1">## signo estable</span>
<span class="k">def</span><span class="w"> </span><span class="nf">is_sign_stable</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">signs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;OLS&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Huber&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tukey&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Bootstrap Mean&#39;</span><span class="p">]])</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">signs</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># todos iguales</span>

<span class="c1">## Consistencia entre metodos (tolerancia 20%)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">is_consistent_methods</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.20</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cambios menores al 20% entre:</span>
<span class="sd">    - OLS vs Huber</span>
<span class="sd">    - OLS vs Tukey</span>
<span class="sd">    - OLS vs Bootstrap Mean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;OLS&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    
    <span class="n">ratios</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">abs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Huber&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">base</span><span class="p">),</span>
        <span class="nb">abs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tukey&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">base</span><span class="p">),</span>
        <span class="nb">abs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Bootstrap Mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">base</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">tol</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ratios</span><span class="p">)</span>

<span class="c1">## Se encuentran dentro del intervalo de bootstrap</span>
<span class="k">def</span><span class="w"> </span><span class="nf">is_inside_bootstrap_CI</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">ci_low</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Boot CI 2.5%&#39;</span><span class="p">]</span>
    <span class="n">ci_high</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Boot CI 97.5%&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ci_low</span> <span class="o">&lt;=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Huber&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ci_high</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ci_low</span> <span class="o">&lt;=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Tukey&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ci_high</span><span class="p">)</span>


<span class="c1">#evaluar criterios</span>

<span class="n">df_rob</span><span class="p">[</span><span class="s1">&#39;Signo estable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comparativa</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">is_sign_stable</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_rob</span><span class="p">[</span><span class="s1">&#39;Métodos consistentes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comparativa</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">is_consistent_methods</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_rob</span><span class="p">[</span><span class="s1">&#39;Dentro CI bootstrap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comparativa</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">is_inside_bootstrap_CI</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Criterio final</span>
<span class="n">df_rob</span><span class="p">[</span><span class="s1">&#39;ROBUSTO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">df_rob</span><span class="p">[[</span><span class="s1">&#39;Signo estable&#39;</span><span class="p">,</span><span class="s1">&#39;Métodos consistentes&#39;</span><span class="p">,</span><span class="s1">&#39;Dentro CI bootstrap&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;Sí&quot;</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span>
<span class="p">)</span>

<span class="c1"># Mostrar tabla final de robustez</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">============================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; TABLA FINAL DE ROBUSTEZ&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;============================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">df_rob</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>============================
 TABLA FINAL DE ROBUSTEZ
============================
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OLS</th>
      <th>HAC (Newey-West)</th>
      <th>Huber</th>
      <th>Tukey</th>
      <th>Bootstrap Mean</th>
      <th>Bootstrap Std</th>
      <th>Boot CI 2.5%</th>
      <th>Boot CI 97.5%</th>
      <th>Signo estable</th>
      <th>Métodos consistentes</th>
      <th>Dentro CI bootstrap</th>
      <th>ROBUSTO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>const</th>
      <td>1675.782068</td>
      <td>1675.782068</td>
      <td>1498.414789</td>
      <td>1447.581352</td>
      <td>1686.790722</td>
      <td>260.499415</td>
      <td>1208.094624</td>
      <td>2206.435730</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>Sí</td>
    </tr>
    <tr>
      <th>yr</th>
      <td>1971.334810</td>
      <td>1971.334810</td>
      <td>1980.684888</td>
      <td>1983.600678</td>
      <td>1959.505841</td>
      <td>121.527986</td>
      <td>1733.346816</td>
      <td>2207.858443</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>Sí</td>
    </tr>
    <tr>
      <th>temp</th>
      <td>5113.451580</td>
      <td>5113.451580</td>
      <td>5292.324408</td>
      <td>5267.849285</td>
      <td>5160.362327</td>
      <td>625.717444</td>
      <td>3904.343665</td>
      <td>6345.264957</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>Sí</td>
    </tr>
    <tr>
      <th>hum</th>
      <td>-1240.472156</td>
      <td>-1240.472156</td>
      <td>-1112.728298</td>
      <td>-1059.261669</td>
      <td>-1267.997593</td>
      <td>331.968533</td>
      <td>-1944.698048</td>
      <td>-650.534727</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>Sí</td>
    </tr>
    <tr>
      <th>windspeed</th>
      <td>-2770.389319</td>
      <td>-2770.389319</td>
      <td>-2505.215754</td>
      <td>-2383.170836</td>
      <td>-2780.143244</td>
      <td>533.714690</td>
      <td>-3844.196096</td>
      <td>-1741.039439</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>Sí</td>
    </tr>
    <tr>
      <th>season_2</th>
      <td>1045.704252</td>
      <td>1045.704252</td>
      <td>1031.755316</td>
      <td>1047.371689</td>
      <td>1033.823322</td>
      <td>199.180709</td>
      <td>677.460154</td>
      <td>1464.468929</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>Sí</td>
    </tr>
    <tr>
      <th>season_3</th>
      <td>658.245635</td>
      <td>658.245635</td>
      <td>620.530400</td>
      <td>667.248724</td>
      <td>633.049696</td>
      <td>305.871040</td>
      <td>11.669624</td>
      <td>1211.773529</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>Sí</td>
    </tr>
    <tr>
      <th>season_4</th>
      <td>1424.818629</td>
      <td>1424.818629</td>
      <td>1450.679846</td>
      <td>1466.628557</td>
      <td>1410.154462</td>
      <td>142.060865</td>
      <td>1124.520611</td>
      <td>1689.108598</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>Sí</td>
    </tr>
    <tr>
      <th>weathersit_2</th>
      <td>-374.827386</td>
      <td>-374.827386</td>
      <td>-393.035603</td>
      <td>-407.090262</td>
      <td>-362.170456</td>
      <td>81.434013</td>
      <td>-520.814298</td>
      <td>-206.134011</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>Sí</td>
    </tr>
    <tr>
      <th>weathersit_3</th>
      <td>-1668.389609</td>
      <td>-1668.389609</td>
      <td>-1735.936058</td>
      <td>-1730.500657</td>
      <td>-1657.331872</td>
      <td>230.917395</td>
      <td>-2102.328290</td>
      <td>-1189.897487</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>Sí</td>
    </tr>
    <tr>
      <th>holiday_1</th>
      <td>-527.956358</td>
      <td>-527.956358</td>
      <td>-527.293924</td>
      <td>-540.997266</td>
      <td>-531.687974</td>
      <td>235.608843</td>
      <td>-1010.262558</td>
      <td>-87.796621</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>Sí</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Variables ROBUSTAS, luego de aplicar las validaciones definidas:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_rob</span><span class="p">[</span><span class="n">df_rob</span><span class="p">[</span><span class="s1">&#39;ROBUSTO&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;Sí&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variables ROBUSTAS, luego de aplicar las validaciones definidas:
const
yr
temp
hum
windspeed
season_2
season_3
season_4
weathersit_2
weathersit_3
holiday_1
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="4_mco_matricial.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">4. Implementación Matricial de MCO y diagnosticos de supuestos</p>
      </div>
    </a>
    <a class="right-next"
       href="6_validacion_modelo.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">6. Validación y Selección del Modelo</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importacion-de-librerias">5.1. Importacion de librerias</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lectura-de-datos">5.2. Lectura de datos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#split-data-set-training-and-test">5.3 Split data set (Training and test)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#errores-estandar-hac-neweywest">5.4 Errores estándar HAC (Newey–West).</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-hac-neweywest">Método HAC (Newey–West)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-ols">Modelo OLS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estimador-hac">Estimador HAC</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Estimador HAC</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parametros">Parámetros</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretacion">Interpretación</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimadores-m-robust-huber-y-tukey">5.5 Estimadores M Robust (Huber y Tukey)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aplicacion-sobre-un-modelo-ols">Aplicación sobre un modelo OLS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimador-m-general">Estimador M general</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimador-de-huber">Estimador de Huber</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimador-tukey-bisquare-biweight">Estimador Tukey Bisquare (Biweight)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metodo-huber-y-tukey">5.5.1 Metodo Huber y Tukey</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-temporal-moving-block-bootstrap-2000-replicas">5.5.2. Bootstrap temporal (Moving Block Bootstrap) — 2000 réplicas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eleccion-de-la-longitud-de-bloque-ell">Elección de la longitud de bloque  <span class="math notranslate nohighlight">\(\ell\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tabla-comparativa-robustez-de-los-coeficientes-por-metodo">5.6 Tabla comparativa, robustez de los coeficientes por metodo</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#que-significa-que-un-coeficiente-es-robusto">5.6.1 ¿Qué significa que un coeficiente es “robusto”?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#criterios-de-robustez-utilizados">5.6.2 ¿Criterios de Robustez utilizados?</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Gloria Bastidas - Daniel Carbono - Luis Perez
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>