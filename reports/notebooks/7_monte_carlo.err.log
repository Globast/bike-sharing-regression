Traceback (most recent call last):
  File "/usr/local/python/3.12.1/lib/python3.12/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/home/codespace/.local/lib/python3.12/site-packages/nbclient/client.py", line 1319, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/codespace/.local/lib/python3.12/site-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/python/3.12.1/lib/python3.12/asyncio/base_events.py", line 684, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/codespace/.local/lib/python3.12/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "/home/codespace/.local/lib/python3.12/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/home/codespace/.local/lib/python3.12/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
np.random.seed(42)

# MONTE CARLO ADAPTADO A OLS (statsmodels)

# 1. Cargar el modelo OLS desde pickle
with open("../models/ols_model.pkl", "rb") as f:
    ols_model = pickle.load(f)

# 2. Usa las mismas variables EXACTAS con las que entrenaste
X_base = X_train.copy().values   # <- sin escalar
y_base = y_train.copy().values
n, k = X_base.shape

# 3. Extraer coeficientes del modelo OLS
ols_params = ols_model.params.values
ols_intercept = ols_params[0]       # primer valor = intercepto
ols_betas = ols_params[1:]          # resto = coeficientes

# 4. ParÃ¡metros Monte Carlo
B = 500
rhos = [0.0, 0.3, 0.6, 0.9]
Ns = [n//4, n//2, n]
sigma_eps = 1.0

# FunciÃ³n AR(1)
def simulate_ar1_errors(N, rho, sigma):
    eps = np.random.normal(0, sigma, size=N)
    u = np.zeros(N)
    for t in range(1, N):
        u[t] = rho * u[t-1] + eps[t]
    return u

# Resultados
results = []

for rho in rhos:
    for N in Ns:
        betas_hat = np.zeros((B, k))

        for b in range(B):
            # 1) Resample de filas reales
            idx = np.random.choice(np.arange(n), size=N, replace=True)
            X_sim = X_base[idx, :]

            # 2) Errores AR(1)
            u = simulate_ar1_errors(N, rho, sigma_eps)

            # 3) Y simulado usando el verdadero modelo OLS
            y_sim = ols_intercept + X_sim @ ols_betas + u

            # 4) EstimaciÃ³n OLS (usamos sklearn para rapidez)
            model = LinearRegression().fit(X_sim, y_sim)
            betas_hat[b, :] = model.coef_

        # MÃ©tricas Monte Carlo
        bias = betas_hat.mean(axis=0) - ols_betas
        var = betas_hat.var(axis=0, ddof=1)
        mse = np.mean((betas_hat - ols_betas)**2, axis=0)

        results.append({
            "rho": rho,
            "N": N,
            "bias_mean": bias.mean(),
            "var_mean": var.mean(),
            "mse_mean": mse.mean(),
        })

# DataFrame final
df_res = pd.DataFrame(results)

# GrÃ¡ficas
sns.set(style="whitegrid")
fig, axes = plt.subplots(1, 3, figsize=(18,4), sharex=True)

for rho in rhos:
    df_plot = df_res[df_res["rho"] == rho].sort_values("N")
    axes[0].plot(df_plot["N"], df_plot["bias_mean"], marker='o', label=f"rho={rho}")
    axes[1].plot(df_plot["N"], df_plot["var_mean"], marker='o', label=f"rho={rho}")
    axes[2].plot(df_plot["N"], df_plot["mse_mean"], marker='o', label=f"rho={rho}")

axes[0].axhline(0, color="k", linestyle="--")
axes[0].set_title("Bias promedio vs N")
axes[0].set_xlabel("N")
axes[0].set_ylabel("Bias medio")

axes[1].set_title("Varianza promedio vs N")
axes[1].set_xlabel("N")

axes[2].set_title("MSE promedio vs N")
axes[2].set_xlabel("N")

axes[0].legend()
plt.tight_layout()
plt.show()
------------------


[31m---------------------------------------------------------------------------[39m
[31mNameError[39m                                 Traceback (most recent call last)
[36mCell[39m[36m [39m[32mIn[3][39m[32m, line 7[39m
[32m      3[39m [38;5;66;03m# MONTE CARLO ADAPTADO A OLS (statsmodels)[39;00m
[32m      4[39m 
[32m      5[39m [38;5;66;03m# 1. Cargar el modelo OLS desde pickle[39;00m
[32m      6[39m [38;5;28;01mwith[39;00m [38;5;28mopen[39m([33m"[39m[33m../models/ols_model.pkl[39m[33m"[39m, [33m"[39m[33mrb[39m[33m"[39m) [38;5;28;01mas[39;00m f:
[32m----> [39m[32m7[39m     ols_model = [43mpickle[49m.load(f)
[32m      9[39m [38;5;66;03m# 2. Usa las mismas variables EXACTAS con las que entrenaste[39;00m
[32m     10[39m X_base = X_train.copy().values   [38;5;66;03m# <- sin escalar[39;00m

[31mNameError[39m: name 'pickle' is not defined

